#!/usr/bin/env node

/**
 * Build script to generate a string version of the smart-dom-reader bundle
 * that can be embedded directly in the DomExtractionTools class.
 */

import { readFileSync, writeFileSync } from 'node:fs';
import { dirname, resolve } from 'node:path';
import { fileURLToPath } from 'node:url';

const __dirname = dirname(fileURLToPath(import.meta.url));

// Read the bundle
const bundlePath = resolve(__dirname, 'dist-bundle/smart-dom-reader-bundle.js');
const bundleContent = readFileSync(bundlePath, 'utf-8');

// Create a TypeScript file that exports the bundle as a string
const outputContent = `/**
 * Auto-generated file containing the smart-dom-reader bundle as a string
 * DO NOT EDIT MANUALLY - Generated by build-bundle-string.js
 */

export const SMART_DOM_READER_BUNDLE = ${JSON.stringify(bundleContent)};
`;

// Write to a TypeScript file
const outputPath = resolve(__dirname, 'dist-bundle/bundle-string.ts');
writeFileSync(outputPath, outputContent);

console.log(`Bundle string generated at: ${outputPath}`);
console.log(`Bundle size: ${(bundleContent.length / 1024).toFixed(2)} KB`);
